% ============================================
% SEZIONE 9: RISULTATI SPERIMENTALI
% ============================================

\section{Risultati Sperimentali}
\label{sec:risultati}

Questa sezione presenta i risultati ottenuti dal training dei modelli e le performance del sistema completo.

\subsection{Setup Sperimentale}

\subsubsection{Hardware}
\begin{table}[H]
\centering
\begin{tabular}{ll}
\toprule
\textbf{Componente} & \textbf{Specifiche} \\
\midrule
GPU & 2$\times$ NVIDIA RTX 5090 (32GB VRAM ciascuna) \\
Configurazione & Multi-GPU con DataParallel \\
Precision & Mixed Precision (FP16) \\
Piattaforma & Workstation remota \\
\bottomrule
\end{tabular}
\caption{Configurazione hardware utilizzata per il training.}
\label{tab:hardware}
\end{table}

\subsubsection{Software}
\begin{table}[H]
\centering
\begin{tabular}{ll}
\toprule
\textbf{Libreria} & \textbf{Versione} \\
\midrule
Python & 3.10+ \\
PyTorch & 2.5+ \\
Ultralytics & 8.3+ \\
timm & 0.9+ \\
Flask & 3.0+ (piattaforma labeling) \\
\bottomrule
\end{tabular}
\caption{Stack software utilizzato.}
\label{tab:software}
\end{table}

\subsection{Metriche per Modello}

\subsubsection{Backbone YOLO11 Dog-Pose (v2)}

Training: 150 epochs su dataset dog-pose (6,773 train / 1,703 val).

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} \\
\midrule
mAP@0.5 & $> 0.85$ & \textbf{0.987} \\
Precision & $> 0.90$ & \textbf{0.969} \\
Recall & $> 0.90$ & \textbf{0.977} \\
Inference time (GPU) & $< 20$ms & $\sim 8$ms \\
\bottomrule
\end{tabular}
\caption{Metriche backbone Dog-Pose v2. Performance eccellenti con mAP del 98.7\%.}
\label{tab:results_backbone}
\end{table}

\subsubsection{Collar Detector (v2)}

Training: 100 epochs su 7,576 immagini dalla piattaforma di labeling (2 annotatori).

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} \\
\midrule
mAP@0.5 & $> 0.75$ & \textbf{0.853} \\
mAP@0.5:0.95 & $> 0.50$ & \textbf{0.722} \\
Precision & $> 0.70$ & \textbf{0.741} \\
Recall & $> 0.70$ & \textbf{0.854} \\
\bottomrule
\end{tabular}
\caption{Metriche Collar Detector v2. Miglioramento del 67\% rispetto a v1 (mAP 0.51).}
\label{tab:results_collar}
\end{table}

\paragraph{Validazione contro Annotazioni Umane:}

\begin{table}[H]
\centering
\begin{tabular}{lc}
\toprule
\textbf{Metrica} & \textbf{Valore} \\
\midrule
Immagini con label umano & 133 \\
Accuracy (Model vs Human) & \textbf{86.5\%} \\
Precision & 84.8\% \\
Recall & 87.5\% \\
F1 Score & \textbf{86.2\%} \\
\bottomrule
\end{tabular}
\caption{Confronto predizioni modello v2 vs annotazioni umane.}
\label{tab:results_collar_human}
\end{table}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{figures/collar_confusion_matrix.png}
    \caption{Confusion matrix normalizzata del Collar Detector v2. Le tre classi sono ``Dog-with-Leash'' (con accessori), ``Dog-without-Leash'' (senza accessori) e ``background''. La diagonale principale mostra le detection corrette.}
    \label{fig:collar_confusion}
\end{figure}

\subsubsection{Skin Classifier}

Training: ResNet50 fine-tuned su dataset patologie cutanee canine (6 classi).

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} \\
\midrule
Accuracy & $> 0.80$ & \textbf{0.806} \\
F1-Score (macro) & $> 0.75$ & \textbf{0.761} \\
Precision (macro) & $> 0.75$ & 0.78 \\
Recall (macro) & $> 0.70$ & 0.76 \\
\bottomrule
\end{tabular}
\caption{Metriche Skin Classifier. Accuracy target raggiunta.}
\label{tab:results_skin}
\end{table}

\paragraph{Classi rilevate:}
\begin{itemize}
    \item \textbf{Healthy}: Pelle sana
    \item \textbf{Dermatitis}: Infiammazione cutanea
    \item \textbf{Fungal}: Infezioni fungine
    \item \textbf{Hypersensitivity}: Reazioni allergiche
    \item \textbf{Demodicosis}: Rogna demodettica
    \item \textbf{Ringworm}: Tigna
\end{itemize}

\subsubsection{Pose Classifier}

Training: MLP con weak supervision sui 24 keypoints normalizzati (15,132 campioni bilanciati).

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} \\
\midrule
Accuracy & $> 0.70$ & 0.589 \\
AUC-ROC & $> 0.75$ & 0.633 \\
\bottomrule
\end{tabular}
\caption{Metriche Pose Classifier. Risultati sotto-target, come atteso per weak supervision.}
\label{tab:results_pose}
\end{table}

\paragraph{Nota:} Il Pose Classifier opera con \textbf{weak supervision} e raggiunge performance sotto-target (AUC 0.633 vs target 0.75). Come discusso nella Sezione~\ref{sec:pose}, questo \`e un risultato \textbf{atteso} per approcci weak-supervised dove i label derivano dall'origine del dataset. Nonostante ci\`o, il componente viene mantenuto con peso 25\% nella fusione: un AUC $> 0.5$ indica che il modello cattura informazione utile, e il costo computazionale \`e nullo (usa keypoints gi\`a estratti).

\subsubsection{Breed Classifier}

Training: EfficientNet-B0 fine-tuned su Stanford Dogs (120 razze $\rightarrow$ 12 macro-categorie).

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} \\
\midrule
Top-1 Accuracy & $> 0.60$ & \textbf{0.863} \\
\bottomrule
\end{tabular}
\caption{Metriche Breed Classifier. Accuracy supera ampiamente il target (86.3\% vs 60\%).}
\label{tab:results_breed}
\end{table}

\paragraph{Utilizzo:} La razza viene usata per identificare razze tipicamente ``di casa'' (es. Chihuahua, Barboncino) vs razze spesso randagie (es. meticci, pitbull). Contribuisce al 20\% della fusione finale attraverso i prior $P(\text{stray}|\text{breed})$.

\subsection{Performance Sistema Completo}

\subsubsection{Latenza End-to-End}

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Componente} & \textbf{GPU (ms)} & \textbf{CPU (ms)} \\
\midrule
Backbone (YOLO11n) & $\sim 8$ & $\sim 50$ \\
Collar Detector (YOLOv8n) & $\sim 6$ & $\sim 40$ \\
Skin Classifier (ResNet50) & $\sim 10$ & $\sim 80$ \\
Pose Classifier (MLP) & $< 1$ & $\sim 2$ \\
Breed Classifier (EfficientNet) & $\sim 8$ & $\sim 60$ \\
Fusion & $<1$ & $<1$ \\
\midrule
\textbf{Totale (sequenziale)} & $\sim 35$ & $\sim 235$ \\
\bottomrule
\end{tabular}
\caption{Latenza per componente e totale del sistema.}
\label{tab:latency}
\end{table}

\subsubsection{Throughput}

\begin{table}[H]
\centering
\begin{tabular}{lcc}
\toprule
\textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} \\
\midrule
FPS (GPU) & $> 15$ & $\sim 28$ \\
FPS (CPU) & $> 5$ & $\sim 4$ \\
\bottomrule
\end{tabular}
\caption{Throughput del sistema. Su GPU supera ampiamente il target.}
\label{tab:throughput}
\end{table}

\subsection{Analisi Qualitativa}

\subsubsection{Casi di Successo}

% Placeholder per immagini di esempio
% \begin{figure}[H]
%     \centering
%     \begin{subfigure}{0.45\textwidth}
%         \includegraphics[width=\textwidth]{figures/success_stray.png}
%         \caption{Cane randagio correttamente identificato}
%     \end{subfigure}
%     \begin{subfigure}{0.45\textwidth}
%         \includegraphics[width=\textwidth]{figures/success_owned.png}
%         \caption{Cane padronale correttamente identificato}
%     \end{subfigure}
%     \caption{Esempi di classificazione corretta.}
% \end{figure}

\subsubsection{Casi di Errore}

% Analisi dei failure cases pi\`u comuni:
% - False positive (padronale classificato come randagio)
% - False negative (randagio classificato come padronale)
% - Edge cases

\subsection{Riepilogo Risultati}

\begin{table}[H]
\centering
\begin{tabular}{llccc}
\toprule
\textbf{Modello} & \textbf{Metrica} & \textbf{Target} & \textbf{Ottenuto} & \textbf{Status} \\
\midrule
Backbone v2 & mAP@0.5 & $> 0.85$ & \textbf{0.987} & \checkmark \\
Collar v2 & mAP@0.5 & $> 0.75$ & \textbf{0.853} & \checkmark \\
Skin & Accuracy & $> 0.80$ & \textbf{0.806} & \checkmark \\
Pose$^*$ & AUC-ROC & $> 0.75$ & 0.633 & $\sim$ \\
Breed & Top-1 Acc & $> 0.60$ & \textbf{0.863} & \checkmark \\
\midrule
Sistema (GPU) & Latency & $< 50$ms & $\sim 35$ms & \checkmark \\
Sistema (GPU) & FPS & $> 15$ & $\sim 28$ & \checkmark \\
\bottomrule
\end{tabular}
\caption{Riepilogo delle metriche principali. $^*$Pose Classifier sotto-target ma mantenuto (vedi discussione).}
\label{tab:results_summary}
\end{table}

\paragraph{Osservazioni finali:}
\begin{itemize}
    \item \textbf{Backbone}: Performance eccezionali (mAP 98.7\%) grazie al dataset dog-pose specializzato
    \item \textbf{Collar}: Miglioramento del 67\% (da 0.51 a 0.853 mAP) grazie alla piattaforma di labeling custom
    \item \textbf{Validazione umana}: Accordo del 86.5\% tra modello collar e annotatori umani
    \item \textbf{Pose}: Risultati sotto-target (AUC 0.633) come atteso per weak supervision. \textbf{Decisione}: componente mantenuto per complementarit\`a e costo nullo (Sezione~\ref{sec:pose})
    \item \textbf{Breed}: Eccellente accuracy (86.3\%) su 12 macro-categorie, permette applicazione efficace dei prior $P(\text{stray}|\text{breed})$
    \item \textbf{Real-time}: Il sistema opera a $\sim$28 FPS su GPU, adatto a stream video
\end{itemize}
